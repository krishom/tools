<!doctype html>
<html>
  <head>
    <title>Safeway J4U Coupon Clipper</title>
    <style>
      body {
        font-family: arial, sans-serif;
      }
      img {
        box-shadow: 2px 2px 2px;
      }
    </style>
  </head>
  <body>
    <h3>Bookmarklet</h3>
    Drag this link to your bookmarks bar: <a href="javascript:(function(){if(0>window.location.href.indexOf('safeway.com/ShopStores/Justforu-Coupons.page'))window.location.replace('http://safeway.com/ShopStores/Justforu-Coupons.page');else{var e=[],d=function(){window.scrollTo&&window.scrollTo(0,document.body.offsetHeight);window.setTimeout(function(){window.scrollBy&&window.scrollBy(0,-1)},100);window.setTimeout(l,2E3)},m=function(a){return a},g=function(a){return a.parentNode},b=function(a,c){for(var h=0,b=document.querySelectorAll(a),d=0,f;f=b[d++];)'none'!=getComputedStyle(c(f)).display&&(e.push(f),h++);return h},k=function(){var a=e.shift();if(a){var c=a,b=curTop=0;if(c.offsetParent){do b+=c.offsetLeft,curTop+=c.offsetTop;while(c=c.offsetParent)}window.scrollTo&&window.scrollTo(b,curTop-150);a.click()}0<e.length?window.setTimeout(k,500):d()},l=function(){0<b('.lt-add-offer-gallery',m)+b('.lt-add-offer-link',g)+b('.lt-button-primary',g)&&k()};d()}})();">Just4U</a><br><br>
    Example:<br>
    <img src="bookmarklet.png">
    <h3>Instructions</h3>
    <ol>
      <li>Log in to the <a href="http://www.safeway.com/ShopStores/Justforu-CouponCenter.page?">safeway.com Coupon Center</a></li>
      <li>When the page loads, click the "Just4U" bookmarklet you created above.</li>
      <li>Each item will be added to your card sequentially.</li>
    </ol>
    <h3>Uncompiled Source</h3>
    <pre>
(function() {
  var url = 'safeway.com/ShopStores/Justforu-Coupons.page';
  if (window.location.href.indexOf(url) < 0) {
    window.location.replace('http://' + url);
    return;
  }
  var toClick = [];
  var scrollToElement = function(el) {
    var curLeft = curTop = 0;
    if (el.offsetParent) {
      do {
        curLeft += el.offsetLeft;
        curTop += el.offsetTop;
      } while (el = el.offsetParent);
    }
    window.scrollTo && window.scrollTo(curLeft, curTop - 150);
  };
  var scrollToBottom = function() {
    window.scrollTo && window.scrollTo(0, document.body.offsetHeight);
    window.setTimeout(function() {
      window.scrollBy && window.scrollBy(0, -1);
    }, 100);
    window.setTimeout(clickAllActive, 2000);
  };
  var getSelf = function(el) {
    return el;
  };
  var getParent = function(el) {
    return el.parentNode;
  };
  var findActive = function(selector, getter) {
    var count = 0;
    var links = document.querySelectorAll(selector);
    for (var i = 0, link; link = links[i++];) {
      if (getComputedStyle(getter(link)).display != 'none') {
        toClick.push(link);
        count++;
      }
    }
    return count;
  };
  var clickNext = function() {
    var el = toClick.shift();
    if (el) {
      scrollToElement(el);
      el.click();
    }
    if (toClick.length > 0) {
      window.setTimeout(clickNext, 500);
    } else {
      scrollToBottom();
    }
  };
  var clickAllActive = function() {
    if (findActive('.lt-add-offer-gallery', getSelf) +
        findActive('.lt-add-offer-link', getParent) +
        findActive('.lt-button-primary', getParent) > 0) {
      clickNext();
    }
  };
  scrollToBottom();
})();
    </pre>
  </body>
</html>
