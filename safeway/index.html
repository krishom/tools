<!doctype html>
<html>
  <head>
    <title>Safeway J4U Coupon Clipper</title>
    <style>
      body {
        font-family: arial, sans-serif;
      }
      img {
        box-shadow: 2px 2px 2px;
      }
    </style>
  </head>
  <body>
    <h3>Bookmarklet</h3>
    Drag this link to your bookmarks bar:
    <a
      href="javascript:(()=>{var e='/foru/coupons-deals.html';if(window.location.href.indexOf(e)<0)window.location.replace('https://www.safeway.com'+e);else{let o=e=>{[...document.querySelectorAll(e)].forEach(e=>{0<e.offsetHeight&&e.click()})},e=()=>o('.btn.load-more'),l=()=>{e();var t=document.querySelector('coupon-grid').querySelectorAll('.btn-primary');if(0<t.length){let e=0;t.forEach(t=>setTimeout(()=>{var e;(e=t).scrollIntoView(),e.dispatchEvent(new Event('click')),o('button.close'),o('button.btn.btn-default.btn-modal')},e+=333)),setTimeout(l,e+333)}};e(),setTimeout(l,1e3),o('div[aria-label=\'Close\']'),o('div[aria-label=\'Close Notification\']')}})();"
      >Just4U</a
    >
    <br /><br />
    Example:<br />
    <img src="bookmarklet.png" />
    <h3>Instructions</h3>
    <ol>
      <li>
        Log in to the
        <a href="https://www.safeway.com/account/sign-in.html"
          >safeway.com Coupon Center</a
        >
      </li>
      <li>
        When the page loads, click the "Just4U" bookmarklet you created above.
      </li>
      <li>Each item will be added to your card sequentially.</li>
    </ol>
    <h3>Uncompiled Source</h3>
    <pre>
(() => {
  const url = "/foru/coupons-deals.html";
  if (window.location.href.indexOf(url) < 0) {
    window.location.replace("https://www.safeway.com" + url);
    return;
  }
  const scrollAndClick = (el) => {
    el.scrollIntoView();
    el.dispatchEvent(new Event("click"));
  };
  const clickIfVisible = (query) => {
    [...document.querySelectorAll(query)].forEach((el) => {
      if (el.offsetHeight > 0) {
        el.click();
      }
    });
  };
  const loadMore = () => clickIfVisible(".btn.load-more");
  const clipAll = () => {
    loadMore();
    const interval = 333;
    const buttons = document
      .querySelector("coupon-grid")
      .querySelectorAll(".btn-primary");
    if (buttons.length > 0) {
      let delay = 0;
      buttons.forEach((btn) =>
        setTimeout(
          () => {
            scrollAndClick(btn);
            clickIfVisible("button.close");
            clickIfVisible("button.btn.btn-default.btn-modal");
          },
          (delay += interval)
        )
      );
      setTimeout(clipAll, delay + interval);
    }
  };
  loadMore();
  setTimeout(clipAll, 1000);
  clickIfVisible(`div[aria-label='Close']`);
  clickIfVisible(`div[aria-label='Close Notification']`);
})();
    </pre>
  </body>
</html>
